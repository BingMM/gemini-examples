# KHI_BGfield example

This example simulates ionospheric Kelvin-Helmholtz instability; with excitation through the background field inputs (unlike other KHI examples).  An advantage of this approach is that it is more straightforward to have an zero-order equilibrium state that includes a field-aligned current to balance the system (as opposed to the usual formulation where a neutral wind balances the zero-order currents.  

## Zero-order equilibrium

This type of simulation will enforce zero current divergence; which can be provided by boundary conditions that create balance, by background flows or winds, or it can be enforced implicity by charge density created internally to the conducting ionospheric part of the simulation if driven with unbalanced currents via inital and boundary conditions.  In the classic papers on ionospheric KHI the balancing current is provided by a neutral wind dynamo; however, any process that removes charge from the region where it otherwise would tend to accumulate due to the fields perpendicular will suffice; I.e. a presumed field-aligned current could provide the balance insofar as charge accumulation is concerned.  If one simply omits the balancing process in the initial and boundary condition charge accumulation from the (apparent) imbalance will create a response field to drive the simulation back to a div(Jperp) = 0 state.  

There are subtleties to specifying a background electric field -- even if it has been tuned in the initial conditions to balance the zero-order current density.  Scaled initial conditions, as needed to create density profiles, which are different on either side of the boundary layer, will shift around in altitude and also recombine at different rates (due to different drifts/heating), resulting in a response potential with large-scale variations that will tend to drive toward a numerical equilbrium.  Further as the simulation progresses E-region density tends to accumulate near the boundary which will have a tendency to short out the instability.  

The balancing process(whether wind-driven for FAC in nature) cannot solely be calculated on the basis of the zero-order electric field and updated conductivity in the model.  The perpendicular current thus computed will contain fluctuations from the density structures that should be in the perturbed potential (and not counted as part of the source terms).  Because of this one must compute smooth background fields *and* FACs a priori so they are specified as model inputs.  Again, if the conductivity at each time step in the model is used to get source terms there will be lack of instability and the perturbed potential will remain zero (if so initialized).  If one seeds the initial potential with noise but the perturbations will simply decay at the inertial relaxation time leaving perhaps some stationary perturbed potential (tests suggest).   

Using existing, FAC-mode inputs it should be possible to specify a FAC that balances the initial state *without perturbations* which will allow said perturbations, in principle to grow.  It must be the case that this FAC correspond exactly to the zero-order source term for the potential equation and that it remain constant in time through the simulation.  Notably, this requires calculations of the conductivities in the setup scripts for the simulations.  



